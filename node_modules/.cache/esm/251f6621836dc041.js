let express,axios,SpotifyStrategy;_836‍.x([["router",()=>router],["prefix",()=>prefix],["searchArtistsToJSON",()=>searchArtistsToJSON],["albumsToJSON",()=>albumsToJSON],["tracksToJSON",()=>tracksToJSON]]);_836‍.w("express",[["default",["express"],function(v){express=v}]]);_836‍.w("axios",[["default",["axios"],function(v){axios=v}]]);_836‍.w("passport-spotify",[["default",["SpotifyStrategy"],function(v){SpotifyStrategy=v}]]);




//const SpotifyStrategy = require('passport-spotify').Strategy;

passport.use(
  new SpotifyStrategy(
    {
      clientID: 'ef86bf0f442d4c679b520c3fcd1dc87b',
      clientSecret: '74a7222419fd435583c79c5a124a1e33',
      callbackURL: 'http://localhost:8888/auth/spotify/callback'
    },
    function(accessToken, refreshToken, expires_in, profile, done) {
      User.findOrCreate({ spotifyId: profile.id }, function(err, user) {
        return done(err, user);
      });
    }
  )
);
















       const router = express.Router();
       const prefix = '/spotify';

const OAuthToken = 'BQAg5xyoE_5DhXx8RwIAm6YwJN6tsa8yd9Kj7jTQNm00tCJXxZWzVboLQtBzbPnl9VLGmzqCQunImovBa3tHiYeJicB06TT3161wbnaQ_jqOrmCxu8QImksd0iNEt8nQIgBReA_xFhzb';

router.get('/artist', function (req, res) {  

    //  Search term should be artist's name
    var searchTerm = req.query.searchTerm;

    var querySpotify = async () => {
        var result = await axios({
          method: 'get',
          url: 'https://api.spotify.com/v1/search?q=' + searchTerm + '&type=artist&limit=50',
          headers: {
            'Authorization': 'Bearer ' + OAuthToken,
            'Content-Type': 'application/json',
          }
        });
        return result;
      }

      querySpotify().then(function(result) {
        res.send(searchArtistsToJSON(result));
      })
});

router.get('/artistAlbums', function (req, res) {

    // search term should be the artist's spotifyID
    var searchTerm = req.query.searchTerm;

    // 38EmEgXkgK51MT2tPY0EoC = bobby

    var querySpotify = async () => {
        var result = await axios({
          method: 'get',
          url: 'https://api.spotify.com/v1/artists/' + searchTerm + '/albums?limit=50',
          headers: {
            'Authorization': 'Bearer ' + OAuthToken,
            'Content-Type': 'application/json',
          }
        });
        return result;
      }
    
      querySpotify().then(function(result) {
        res.send(albumsToJSON(result));
      }) 

});

router.get('/albumTracks', function (req, res) {

  //  Search term should be album's ID
  var searchTerm = req.query.searchTerm;

  var querySpotify = async () => {
    var result = await axios({
      method: 'get',
      url: 'https://api.spotify.com/v1/albums/' + searchTerm + '/tracks?limit=25',
      headers: {
        'Authorization': 'Bearer ' + OAuthToken,
        'Content-Type': 'application/json',
      }
    });
    return result;
  }

  querySpotify().then(function(result) {
    res.send(tracksToJSON(result));
  })


});


// Create JSON file for Artists returned from a search
       function searchArtistsToJSON(searchResult) {
  var artists = new Array();
  var data = searchResult.data.artists.items;
  
  for (var i = 0; i < data.length; i++) {
    var artist = data[i];
    var IMGURL = (artist.images.length > 0) ? artist.images[0].url : null;
    artists.push({
      name: artist.name,
      artistID: artist.id,
      artistURL: artist.external_urls.spotify,
      genres: artist.genres,
      spotify_followers: artist.followers.total,
      imageURL: IMGURL,
    })
  }

  return artists;
}

// Create JSON file for Albums returned from a search
       function albumsToJSON(searchResult) {
  var albums = new Array();
  var data = searchResult.data.items;
  
  for (var i = 0; i < data.length; i++) {
    var album = data[i];
    var IMGURL = (album.images.length > 0) ? album.images[0].url : null;
    albums.push({
      artist: album.artists[0].name,
      artistID: album.artists[0].id,
      album: album.name,
      imageURL: IMGURL,
      albumID: album.uri.substring(14)
    })
  }
  
  return albums;
}

       function tracksToJSON(searchResult) {
  var tracks = new Array();
  var data = searchResult.data.items;
  _836‍.g.console.log(data);

  for (var i = 0; i < data.length; i++) {
    var track = data[i];
    tracks.push({
      name: track.name,
      duration: track.duration_ms,
      number: track.track_number,
      sampleURL: track.preview_url,
    })
  }

  return tracks;

}